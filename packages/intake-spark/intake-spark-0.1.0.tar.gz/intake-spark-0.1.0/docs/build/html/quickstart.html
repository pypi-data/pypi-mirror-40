

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Quickstart &mdash; intake_spark 0.0.0+3.gadf091e.dirty documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="intake_spark 0.0.0+3.gadf091e.dirty documentation" href="index.html"/>
        <link rel="next" title="API Reference" href="api.html"/>
        <link rel="prev" title="Welcome to intake-spark’s documentation!" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> intake_spark
          

          
          </a>

          
            
            
              <div class="version">
                0.0.0+3.gadf091e.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quickstart</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#establishing-a-context">Establishing a Context</a></li>
<li class="toctree-l3"><a class="reference internal" href="#encoding-spark-calls">Encoding Spark calls</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-in-a-catalog">Using in a catalog</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">intake_spark</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Quickstart</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/quickstart.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="quickstart">
<h1>Quickstart<a class="headerlink" href="#quickstart" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">intake-spark</span></code> provides quick and easy access to data via
<a class="reference external" href="http://spark.apache.org/docs/latest/">Apache Spark</a></p>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>To use this plugin for <a class="reference external" href="https://github.com/ContinuumIO/intake">intake</a>, install with the following command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">intake</span> <span class="n">intake</span><span class="o">-</span><span class="n">spark</span>
</pre></div>
</div>
</div>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<div class="section" id="establishing-a-context">
<h3>Establishing a Context<a class="headerlink" href="#establishing-a-context" title="Permalink to this headline">¶</a></h3>
<p>Operations on a Spark cluster are achieved via a “context”, which is a python-side client to the remote system. All
use of this package require a valid context in order to work. There are two ways to establish the context:</p>
<ul class="simple">
<li>use the function <code class="docutils literal notranslate"><span class="pre">intake_spark.base.SparkHolder.set_class_session()</span></code>, passing for <code class="docutils literal notranslate"><span class="pre">context=</span></code> and <code class="docutils literal notranslate"><span class="pre">session=</span></code>
the respective existing objects that have been created previously using conventional means. In this case, Spark
connection-specific parameters are not encoded in the catalog. Since intake-spark uses <code class="docutils literal notranslate"><span class="pre">getOrCreate()</span></code>, the
existence of the objects should be enough for them to be picked up at data access time, but we still recommend
calling the set function explicitly. Note that if only using RDDs and no SQl functionality, the <code class="docutils literal notranslate"><span class="pre">session</span></code> need
not be created or provided.</li>
<li>the same function can also take a set of parameters, in which case intake-spark will attempt to create the context
and session for you, passing the parameters (master, app_name, executor_env, spark_home and config parameters) on
to Spark. In this case, the parameters can be stored in a catalog (the <code class="docutils literal notranslate"><span class="pre">context_kwargs</span></code> parameter, a dictionary).
If providing an empty set of parameters, Spark will create the default local context, which is useful only for
testing.</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># in-code example</span>
<span class="kn">from</span> <span class="nn">intake_spark.base</span> <span class="kn">import</span> <span class="n">SparkHolder</span>
<span class="kn">import</span> <span class="nn">intake</span>
<span class="n">SparkHolder</span><span class="o">.</span><span class="n">set_class_session</span><span class="p">(</span><span class="n">master</span><span class="o">=</span><span class="s1">&#39;spark://myhost:7077&#39;</span><span class="p">,</span> <span class="n">app_name</span><span class="o">=</span><span class="s1">&#39;intake&#39;</span><span class="p">,</span> <span class="n">hive</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="encoding-spark-calls">
<h3>Encoding Spark calls<a class="headerlink" href="#encoding-spark-calls" title="Permalink to this headline">¶</a></h3>
<p>Spark calls are often expressed as a chain of attribute look-ups with some being called as methods with arguments.
To encode these for Intake, we make each stage of the chain an element in a list, starting from the Context or
Session for the RDD and DataFrame versions of the driver. For example, the following encodes
<code class="docutils literal notranslate"><span class="pre">sc.textfile('s3://bucket/files*.txt')</span></code>, i.e., a single element of attribute lookup</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">=</span> <span class="n">intake</span><span class="o">.</span><span class="n">open_spark_rdd</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;textFile&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;s3://bucket/files*.txt&#39;</span><span class="p">,))</span>
    <span class="p">])</span>
<span class="n">rdd</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">to_spark</span><span class="p">()</span>
</pre></div>
</div>
<p>Here <code class="docutils literal notranslate"><span class="pre">rdd</span></code> will be a pySpark RDD instance.</p>
<p>A more complicated example, for encoding <code class="docutils literal notranslate"><span class="pre">spark.read.option(&quot;mergeSchema&quot;,</span> <span class="pre">&quot;true&quot;).parquet(&quot;data/test_table&quot;)</span></code>
for use with Intake</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">=</span> <span class="n">intake</span><span class="o">.</span><span class="n">open_spark_dataframe</span><span class="p">([</span>
    <span class="p">(</span><span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;option&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;mergeSchema&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;parquet&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;data/test_table&quot;</span><span class="p">,))</span>
    <span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">to_spark</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that you <em>cannot</em> pass functions using this formalism, only literals.</p>
</div>
<div class="section" id="using-in-a-catalog">
<h3>Using in a catalog<a class="headerlink" href="#using-in-a-catalog" title="Permalink to this headline">¶</a></h3>
<p>The above example could be expressed in YAML syntax as follows</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">sources</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">spark_dataframe</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">args</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">args</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">read</span>
      <span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">option</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">mergeSchema</span>
          <span class="p p-Indicator">-</span> <span class="s">&#39;true&#39;</span>
      <span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">parquet</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">data/test_table</span>
      <span class="l l-Scalar l-Scalar-Plain">context_kwargs</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">master</span><span class="p p-Indicator">:</span> <span class="s">&quot;spark://myhost:7077&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">app_name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">intake</span>
    <span class="l l-Scalar l-Scalar-Plain">description</span><span class="p p-Indicator">:</span> <span class="s">&#39;&#39;</span>
    <span class="l l-Scalar l-Scalar-Plain">driver</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">spark_dataframe</span>
    <span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
</pre></div>
</div>
<p>Note the complex nesting pattern, and that in this case we are including arguments for creating an appropriate
SparkContext and Session on the fly, if one has not already been made.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api.html" class="btn btn-neutral float-right" title="API Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Welcome to intake-spark’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Martin Durant.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.0.0+3.gadf091e.dirty',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>