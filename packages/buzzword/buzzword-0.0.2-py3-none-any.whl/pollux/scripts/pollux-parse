#!/usr/bin/env python

"""
A script to parse using polly

:Example:

$ buzzword-parse junglebook --speaker-segmentation --metadata --multiprocess=3

"""
import os
import sys
from polly import Corpus
from buzzword.config import CORPUS_DIR
from buzzword import cmd_line_to_kwargs

if len(sys.argv) == 1:
    raise ValueError('Please specify a corpus to parse.')

args = sys.argv[2:]
kwargs = cmd_line_to_kwargs(args)
corp = Corpus(sys.argv[1], lang=kwargs.pop('lang', 'english'))

move_to = CORPUS_DIR
if kwargs.get('user'):
    move_to = os.path.join(CORPUS_DIR, 'uploads', kwargs.get('user'))

if not os.path.isdir(move_to):
    os.makedirs(move_to)

kwargs['outpath'] = move_to
parsed = corp.parse(**kwargs)
name = os.path.basename(parsed.path)

print("\nParsing done! The parsed corpus is now in available at '%s/%s'\n" % (move_to, name))
