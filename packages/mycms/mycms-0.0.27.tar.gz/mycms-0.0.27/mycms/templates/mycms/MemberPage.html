{% extends "base.html" %}
{% load staticfiles %}

{%block YACMS_HEAD %}

<link href="{%static "yacms/css/pageadmin.css" %}" rel="stylesheet">
<link href="{%static "yacms/css/yacms.css" %}" rel="stylesheet">

<script>

var view_json = {{view_object.json_data | safe}}
</script>

<link rel="stylesheet" href="/static/yacms/mediauploader/css/jquery.fileupload.css">
<link rel="stylesheet" href="/static/yacms/mediauploader/css/jquery.fileupload-ui.css">

 <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<link href="/static/assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">


{%endblock YACMS_HEAD %}


{%block DESCRIPTION %}{{view_object.introduction}}{% endblock DESCRIPTION %}
{% block TITLE%} {{view_object.title}}{% endblock TITLE %}
{% block BODY_TITLE%} {{view_object.page_object.parent.title}}{% endblock BODY_TITLE %}





{% block YACMS_PAGE_MAIN_BODY %}

<div class="row-fluid">


        <div class="span3">
                <!-- Nav List -->

                <div class="sidemenu" >
                <ul class="nav nav-list">
                        {% comment %}Also do the parent page contents.{% endcomment %}

                        <li class="nav-header">
                                <a  style="color:#555555;" href="/cms{{view_object.page_object.parent.path.path}}">{{view_object.page_object.parent.title}} </a>
                        </li>
                        {% for topic in view_object.page_object.parent.view.content_topics %}
                        <li><a style="color: #444444; padding-left:25px; line-height:16px;" href="/cms{{view_object.page_object.parent.path.path}}#{{topic.anchor_text}}">{{topic.title}}</a></li>
                        {% endfor %}


                         {% for mb_page_object in view_object.member_page_objects %}

                        <li class="nav-header">
                                <a  style="color:#555555;" href="/cms{{mb_page_object.path.path}}">{{mb_page_object.title}}</a>
                        </li>
                            {% for topic in mb_page_object.view.content_topics %}
                               <li><a style="color: #444444; padding-left:25px; line-height:16px;" href="/cms{{mb_page_object.path.path}}#{{topic.anchor_text}}">{{topic.title}}</a></li>

                            {% endfor %}

                        {% endfor%}

                </ul>
                </div>
                <!-- Nav List End -->
        </div>

        <div class="span9">
                <div id="page_body">
                    {{view_object.html_content | safe }}




                </div>

                <div class="span12" style="margin-left: 0px; margin-right:0px; border-top-style: solid; border-bottom-style: solid;">
                                <div class="span4"><span style="float:left; margin-top:5px;">
                                    {% if view_object.is_first_page %}
                                        <a class="btn btn-small btn-info" href="/cms{{view_object.page_object.parent.path.path}}"><i class="icon-chevron-left"></i>&nbsp;Previous</a></a></span>
                                    {% else%}
                                        <a class="btn btn-small btn-info" href="/cms{{view_object.previous_page.path.path}}"><i class="icon-chevron-left"></i>&nbsp;Previous</a></a></span>
                                    {% endif %}
                                </div>
                                <div class="span4"><center><a href="/cms{{view_object.page_object.parent.path.path}}">{{view_object.page_object.parent.title}}</a></center></div>

                                <div class="span4"><span style="float:right;margin-top:5px;">
                                        {% if view_object.is_last_page == False %}
                                        <a class="btn btn-small btn-info" href="/cms{{view_object.next_page.path.path}}">Next&nbsp;<i class="icon-chevron-right"></i></a></a>
                                        {% endif %}
                                  </span></div>
                </div>

        </div>
    </div>


{% if view_object.request.user.username == "admin" %}


<div class="col-md-12">
        <h3>Page Admin</h3>
        <!-- tabs -->
        <div class="tabbable">
          <ul class="nav nav-tabs">
            <li class="active"><a href="#one" data-toggle="tab">Content Editor</a></li>
            <li class=""><a href="#two" data-toggle="tab" id="file-uploader-tab">File Uploader</a></li>
            <li class=""><a href="#twee" data-toggle="tab">Twee</a></li>
          </ul>

            <div class="tab-content">
                <div class="tab-pane active" id="one">
                    <div class="pageadmin_menu_container">
                      <a href="#" id='editor_save_button' class="btn btn-primary" role="button">Save</a>
                      <!-- a href="#" class="btn btn-primary" role="button" id="editor_publish">Publish</a -->
                      <!-- a href="#" class="btn btn-primary" role="button" id="editor_frontpage">Frontpage</a -->
                        <div class="pageadmin_checkbox"><input id="published_checkbox" type="checkbox" name="published" value="published"  onclick="handle_published_checked(this)">published</div>
                        <div class="pageadmin_checkbox"><input id="frontpage_checkbox" type="checkbox" name="frontpage" value="frontpage"  onclick="handle_frontpage_checked(this)">frontpage</div>
                    </div>

                <div class='clear'></div>
                <div><textarea id="editor_textarea" style="width:100%" rows="30" ></textarea></div>
            </div>


            <div class="tab-pane" id="two">


                <div class="row">

                    <div id="gallery" class="span12"></div>
                </div>


                <div class="row">
                                    <div class="span12" style="margin-top:15px;">
                                        <div class="fileinput-button" style="float:left; margin-right:10px;">
                                            <input type="file" id="addfiles" multiple="multiple" /> <button class="btn btn-warning">Add Files</button>
                                        </div>

                                        <div>
                                         <button class="btn btn-warning" id="upload-files">Upload Files</button>
                                        </div>
                                    </div>
                </div>


                <div id="yacms_gallery"></div>

                <!-- end yacms_gallery-->




            </div>


            <div class="tab-pane" id="twee">
            Thirdamuno, ipsum dolor sit amet, consectetur adipiscing elit.
            Duis pharetra varius quam sit amet vulputate.
            Quisque mauris augue, molestie tincidunt condimentum vitae.
            </div>
        <!-- /tabs -->

        </div>
        <!-- end tab content-->

    </div>
</div>
<div class="clearfix"></div>

{% endif %}



{% endblock YACMS_PAGE_MAIN_BODY %}


{% block YACMS_JAVASCRIPT %}


<script src="{% static "yacms/js/dustjs/dust-full.min.js" %}"></script>
<script src="{% static "yacms/js/yacms.js" %}"></script>
<script src="/static/yacms/mediauploader/js/vendor/jquery.ui.widget.js"></script>
<script src="/static/datetimepicker/jquery.datetimepicker.full.min.js"></script>

<script>

 $( document ).ready(function() {
    get_content(view_json.content[0]);
});

$('#published_checkbox').prop('checked', view_json.published);
$('#frontpage_checkbox').prop('checked', view_json.frontpage);

$('#frontpage_checkbox').click(function(){

  handle_frontpage_checked(this);

});



$('#update_date').click(function(){
    handle_date_changed_clicked();
});


$('#date_created').val("{{view_object.created_timestamp_str}}");
$('#date_created').datetimepicker();

$('#date_modified').val("{{view_object.modified_timestamp_str}}");
$('#date_modified').datetimepicker();



$('#file-uploader-tab').click(function(){


url = "assets_manager/";



    $.ajax({
           url: url,
           type: 'GET',
           error: function(){
               console.log("Failed to get list of images");
           },
           success: function(data){
               //On Success we create the path
               console.log("Got images list data as : ", data);

              $("#gallery").empty();
               for (var i=0; i<data.length; i++){
                   a = "<div class=\"thumbnail\"> <img src=\""+ data[i] +"\"></div>";
                   $("#gallery").append(a);
               }
           }
       });

});


</script>


{% endblock YACMS_JAVASCRIPT %}
