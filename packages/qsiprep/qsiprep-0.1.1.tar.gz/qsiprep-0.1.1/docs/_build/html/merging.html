

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Merging multiple scans from a session &mdash; qsiprep version documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Processing pipeline details" href="workflows.html" />
    <link rel="prev" title="Usage" href="usage.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> qsiprep
          

          
          </a>

          
            
            
              <div class="version">
                version
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="changes.html">What’s new</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Merging multiple scans from a session</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#correction-methods">Correction methods</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="workflows.html">Processing pipeline details</a></li>
<li class="toctree-l1"><a class="reference internal" href="outputs.html">Outputs of qsiprep</a></li>
<li class="toctree-l1"><a class="reference internal" href="reconstruction.html">Reconstruction pipeline details</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributors.html">Contributing to qsiprep</a></li>
<li class="toctree-l1"><a class="reference internal" href="citing.html">Citing qsiprep</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index.html">API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">qsiprep</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Merging multiple scans from a session</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/merging.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="section" id="merging-multiple-scans-from-a-session">
<span id="merging"></span><h1>Merging multiple scans from a session<a class="headerlink" href="#merging-multiple-scans-from-a-session" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>For q-space imaging sequences it is common to have multiple separate scans to
acquire the entire sampling scheme. These scans get aligned and merged into
a single DWI series before reconstruction. It is also common to collect
a DWI scan (or scans) in the reverse phase encoding direction to use for
susceptibility distortion correction (SDC).</p>
<p>This creates a number of possible scenarios for preprocessing your DWIs. These
scenarios can be controlled by the <code class="docutils literal notranslate"><span class="pre">combine_all_dwis</span></code> argument. If your study
has multiple sessions, DWI scans will <em>never</em> be combined across sessions.
Merging only occurs within a session.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">combine_all_dwis</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code> (not present in the commandline call), each dwi
scan in the <code class="docutils literal notranslate"><span class="pre">dwi</span></code> directories will be processed independently. You will have one
preprocessed output per each DWI file in your input.</p>
<p>If <code class="docutils literal notranslate"><span class="pre">combine_all_dwis</span></code> is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, two possibilities arise. If all DWIs in a session
are in the same PE direction, they will be merged into a single series. If there are
two PE directions detected in the DWI scans and <code class="docutils literal notranslate"><span class="pre">'fieldmaps'</span></code> is not in <code class="docutils literal notranslate"><span class="pre">ignore</span></code>,
images are combined according to their PE direction, and their b0 reference images are used to
perform SDC. Either way, at the end of the day, there will be one preprocessed DWI
file per session in your input.</p>
<p>If you have some scans you want to combine and others you want to preprocess separately,
consider creating fake sessions in your BIDS directory.</p>
</div>
<div class="section" id="correction-methods">
<h2>Correction methods<a class="headerlink" href="#correction-methods" title="Permalink to this headline">¶</a></h2>
<p>The are two kinds of SDC available in qsiprep:</p>
<blockquote>
<div><ol class="arabic simple">
<li><a class="reference internal" href="api/index.html#sdc-pepolar"><span class="std std-ref">Phase Encoding POLARity (PEPOLAR) techniques</span></a> (also called <strong>blip-up/blip-down</strong>):
This is the implementation from FMRIPREP, using 3dQwarp to
correct a DWI series using a fieldmap in the fmaps directory.</li>
</ol>
<ol class="arabic">
<li><ol class="first loweralpha simple">
<li>This uses two separe Blip-Up/blip-Down Series (BUDS), again</li>
</ol>
<blockquote>
<div><p>using FMRIPREP’s 3dQwarp implementation, but applying the
correct unwarping transformation depending on each scan’s polarity.</p>
</div></blockquote>
</li>
<li><p class="first"><a class="reference internal" href="api/index.html#sdc-fieldmapless"><span class="std std-ref">Fieldmap-less estimation (experimental)</span></a>: The SyN-based susceptibility distortion correction
implemented in FMRIPREP</p>
</li>
</ol>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">qsiprep</span></code> determines if a fieldmap should be used based on the <code class="docutils literal notranslate"><span class="pre">&quot;IntendedFor&quot;</span></code>
fields in the JSON sidecars in the <code class="docutils literal notranslate"><span class="pre">fmap/</span></code> directory. If you have two DWI
series with reverse phase encodings, but would rather use method 1 instead of
1a, include the <code class="docutils literal notranslate"><span class="pre">--prefer-dedicated-fmaps</span></code> argument.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="workflows.html" class="btn btn-neutral float-right" title="Processing pipeline details" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="usage.html" class="btn btn-neutral" title="Usage" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018-2019, The qsiprep developers

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script type="text/javascript" src="https://cdn.rawgit.com/chrisfilo/zenodo.js/v0.1/zenodo.js"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>